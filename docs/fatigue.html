<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>AI Fatigue Detection ‚Äî SUT</title>
    <link rel="stylesheet" href="styles.css" />
    <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />
  </head>
  <body>
    <div id="sidebarOverlay"></div>

    <div class="page-simple">
      <header class="mini-header">
        <a href="index.html" class="back">‚Üê Home</a>
        <h1>AI Fatigue Detection</h1>
      </header>

      <main class="demo-area">
        <section class="demo-left">
          <h2>Fatigue detection (Live AI)</h2>
          <p class="lead">
            This system uses a Hybrid AI (Swin Transformer + Geometry) to detect
            fatigue. Click <strong>Use Camera</strong> to start the Python
            backend stream.
          </p>

          <div class="controls">
            <!-- ‚úÖ FIXED: Hidden file input + button trigger (same size as others) -->
            <input
              type="file"
              id="videoUpload"
              accept="video/*"
              style="display: none"
              onchange="handleVideoUpload(this)"
            />
            <button
              class="btn primary"
              onclick="document.getElementById('videoUpload').click()"
            >
              Upload Video
            </button>

            <button id="camFat" class="btn primary">Use Camera</button>
            <button id="clearFat" class="btn outline">Stop / Clear</button>
          </div>

          <div
            class="viewer card"
            id="viewerWrapFat"
            style="
              min-height: 400px;
              display: flex;
              align-items: center;
              justify-content: center;
              background: #000;
              position: relative;
            "
          >
            <!-- ‚úÖ UPDATED: Changed logo from sut.logo.png to logo.jpeg -->
            <img
              id="previewFat"
              src="assets/logo.jpeg"
              alt="SUT Logo"
              style="max-height: 300px; opacity: 0.5"
            />
          </div>

          <div class="notes">
            <p>
              <strong>System Status:</strong>
              <em>Connected to Flask Backend</em>
            </p>
            <p class="muted">
              The AI processing (EAR, MAR, Head Pose, Swin) is happening on the
              server.
            </p>
          </div>
        </section>

        <aside class="demo-right">
          <div class="card">
            <h3>Live Logs</h3>
            <div
              id="logAreaFat"
              style="
                max-height: 300px;
                overflow-y: auto;
                font-family: monospace;
                font-size: 0.9em;
              "
            >
              Ready.
            </div>
          </div>
        </aside>
      </main>

      <!-- Example Images Gallery -->
      <section class="fatigue-examples">
        <h2>Detection Examples</h2>
        <p class="lead">
          See how the system detects different states in real-time:
        </p>

        <div class="example-gallery">
          <div class="example-card">
            <div class="example-image-wrapper">
              <img
                src="assets/fatigue photos/fatigue-active.jpeg"
                alt="Active state - Normal detection"
                class="example-img"
              />
              <div class="example-status status-active">Active</div>
            </div>
            <div class="example-info">
              <h3>Normal State</h3>
              <p class="muted">
                System actively monitoring with green bounding box. All metrics
                within normal range.
              </p>
              <div class="example-metrics">
                <span class="metric">AI: 0.05</span>
                <span class="metric">EAR: 0.35</span>
                <span class="metric">Score: 0.03</span>
              </div>
            </div>
          </div>

          <div class="example-card">
            <div class="example-image-wrapper">
              <img
                src="assets/fatigue photos/fatigue-inactive.jpeg"
                alt="Warning state - Fatigue detected"
                class="example-img"
              />
              <div class="example-status status-warning">WARNING: FATIGUE</div>
            </div>
            <div class="example-info">
              <h3>Fatigue Detected</h3>
              <p class="muted">
                Red bounding box indicates fatigue warning. System detects
                drooping eyes and elevated fatigue score.
              </p>
              <div class="example-metrics">
                <span class="metric">AI: 0.67</span>
                <span class="metric">Droop: 0.96</span>
                <span class="metric score-high">Score: 0.60</span>
              </div>
            </div>
          </div>

          <div class="example-card">
            <div class="example-image-wrapper">
              <img
                src="assets/fatigue photos/fatigue-cali.jpeg"
                alt="Calibrating state - System initialization"
                class="example-img"
              />
              <div class="example-status status-calibrating">
                CALIBRATING...
              </div>
            </div>
            <div class="example-info">
              <h3>System Calibration</h3>
              <p class="muted">
                Yellow bounding box shows calibration phase. System establishing
                baseline measurements.
              </p>
              <div class="example-metrics">
                <span class="metric">Progress: 35/45</span>
                <span class="metric">Status: Initializing</span>
              </div>
            </div>
          </div>
        </div>
      </section>

      <footer class="mini-footer">SUT Project Demo</footer>
    </div>

    <script src="app.js"></script>

    <script>
      // Handle video upload
      function handleVideoUpload(input) {
        if (input.files && input.files[0]) {
          const formData = new FormData();
          formData.append("file", input.files[0]);

          // Add to logs
          const logArea = document.getElementById("logAreaFat");
          if (logArea) {
            logArea.innerHTML += `<div>üì§ Uploading: ${input.files[0].name}</div>`;
            logArea.scrollTop = logArea.scrollHeight;
          }

          // Submit to your backend
          fetch("/upload_video", {
            method: "POST",
            body: formData,
          })
            .then((response) => response.json())
            .then((data) => {
              console.log("Upload successful:", data);
              if (logArea) {
                logArea.innerHTML += `<div style="color: #10b981">‚úÖ Upload complete</div>`;
                logArea.scrollTop = logArea.scrollHeight;
              }
              // Start video stream with uploaded file
              if (data.success && data.path) {
                const preview = document.getElementById('previewFat');
                const container = document.getElementById('viewerWrapFat');
                let streamImg = document.getElementById('serverStreamFat');
                
                if (!streamImg && container) {
                  streamImg = document.createElement('img');
                  streamImg.id = 'serverStreamFat';
                  streamImg.style.width = '100%';
                  streamImg.style.display = 'none';
                  streamImg.style.borderRadius = '8px';
                  container.appendChild(streamImg);
                }
                
                if (preview) preview.style.display = 'none';
                if (streamImg) {
                  streamImg.src = "/video_feed?source=" + encodeURIComponent(data.path);
                  streamImg.style.display = 'block';
                }
              }
            })
            .catch((error) => {
              console.error("Upload failed:", error);
              if (logArea) {
                logArea.innerHTML += `<div style="color: #ef4444">‚ùå Upload failed: ${error.message}</div>`;
                logArea.scrollTop = logArea.scrollHeight;
              }
            });
        }
      }
    </script>
  </body>
</html>

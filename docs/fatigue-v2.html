<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>AI Fatigue Detection V2 (3 States) ‚Äî SUT</title>
    <link rel="stylesheet" href="styles.css" />
    <link rel="icon" type="image/x-icon" href="assets/favicon.ico" />
  </head>
  <body>
    <div id="sidebarOverlay"></div>

    <div class="page-simple">
      <header class="mini-header">
        <a href="index.html" class="back">‚Üê Home</a>
        <h1>AI Fatigue Detection V2 (3 Classes)</h1>
      </header>

      <main class="demo-area">
        <section class="demo-left">
          <h2>Fatigue detection V2 (Live AI - 3 Classes)</h2>
          <p class="lead">
            This enhanced system uses a 3-class classification model to detect
            <strong>Alert</strong>, <strong>Non-Vigilant</strong>, and
            <strong>Tired</strong> states. Click
            <strong>Start Webcam</strong> to start live detection OR Click
            <strong>Upload Image</strong> to detect.
          </p>

          <div class="controls">
            <!-- ‚úÖ FIXED: Upload Image Button (same size, colored) -->
            <input
              id="uploadImageInput"
              type="file"
              accept="image/*"
              style="display: none"
            />
            <button
              class="btn primary"
              onclick="document.getElementById('uploadImageInput').click()"
            >
              Upload Image
            </button>

            <button id="camFatV2" class="btn primary">Start Webcam</button>
            <button
              id="captureFatV2"
              class="btn"
              style="background: #ed8936; color: white"
            >
              Capture & Analyze
            </button>
            <button id="clearFatV2" class="btn outline">Stop / Clear</button>
          </div>

          <!-- Auto-detect Checkbox -->
          <div style="text-align: center; margin-top: 1rem">
            <label
              style="
                display: inline-flex;
                align-items: center;
                gap: 0.5rem;
                cursor: pointer;
              "
            >
              <input
                type="checkbox"
                id="autoDetectCheckbox"
                style="width: 18px; height: 18px; cursor: pointer"
              />
              <span>Auto-detect (every 2 seconds)</span>
            </label>
          </div>

          <div
            class="viewer card"
            id="viewerWrapFatV2"
            style="
              min-height: 400px;
              display: flex;
              align-items: center;
              justify-content: center;
              background: #000;
              position: relative;
            "
          >
            <!-- Webcam Video -->
            <video
              id="webcamVideo"
              autoplay
              playsinline
              style="max-width: 100%; max-height: 400px; display: none"
            ></video>

            <!-- ‚úÖ UPDATED: Changed logo from sut.logo.png to logo.jpeg -->
            <img
              id="previewFatV2"
              src="assets/logo.jpeg"
              alt="SUT Logo"
              style="max-height: 300px; opacity: 0.5"
            />

            <!-- Hidden Canvas -->
            <canvas id="captureCanvas" style="display: none"></canvas>
          </div>

          <!-- Detection Results Card -->
          <div
            id="detectionResults"
            class="card"
            style="margin-top: 1rem; display: none"
          >
            <h3>Detection Results</h3>

            <!-- Status Display -->
            <div style="margin: 1rem 0">
              <p style="font-size: 1.2rem; font-weight: bold">
                Status: <span id="statusEmoji">üìä</span>
                <span id="statusText" style="font-size: 1.5rem">--</span>
              </p>
            </div>

            <!-- Confidence Bar -->
            <div style="margin: 1rem 0">
              <p style="font-weight: 600; margin-bottom: 0.5rem">
                Confidence: <span id="confidenceValue">0%</span>
              </p>
              <div
                style="
                  background: #e2e8f0;
                  height: 30px;
                  border-radius: 15px;
                  overflow: hidden;
                "
              >
                <div
                  id="confidenceBar"
                  style="
                    height: 100%;
                    width: 0%;
                    transition: width 0.5s;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    color: white;
                    font-weight: 600;
                  "
                ></div>
              </div>
            </div>

            <!-- Class Probabilities -->
            <div style="margin: 1.5rem 0">
              <p style="font-weight: 600; margin-bottom: 1rem">
                Class Probabilities:
              </p>

              <!-- Alert -->
              <div style="margin-bottom: 0.75rem">
                <div
                  style="
                    display: flex;
                    justify-content: space-between;
                    margin-bottom: 0.25rem;
                  "
                >
                  <span style="font-weight: 600">Alert:</span>
                  <span id="probAlertValue">0%</span>
                </div>
                <div
                  style="
                    background: #e2e8f0;
                    height: 24px;
                    border-radius: 12px;
                    overflow: hidden;
                  "
                >
                  <div
                    id="probAlertBar"
                    style="
                      height: 100%;
                      width: 0%;
                      background: linear-gradient(90deg, #48bb78, #38a169);
                      transition: width 0.5s;
                    "
                  ></div>
                </div>
              </div>

              <!-- Non-Vigilant -->
              <div style="margin-bottom: 0.75rem">
                <div
                  style="
                    display: flex;
                    justify-content: space-between;
                    margin-bottom: 0.25rem;
                  "
                >
                  <span style="font-weight: 600">Non Vigilant:</span>
                  <span id="probNonVigilantValue">0%</span>
                </div>
                <div
                  style="
                    background: #e2e8f0;
                    height: 24px;
                    border-radius: 12px;
                    overflow: hidden;
                  "
                >
                  <div
                    id="probNonVigilantBar"
                    style="
                      height: 100%;
                      width: 0%;
                      background: linear-gradient(90deg, #ed8936, #dd6b20);
                      transition: width 0.5s;
                    "
                  ></div>
                </div>
              </div>

              <!-- Tired -->
              <div style="margin-bottom: 0.75rem">
                <div
                  style="
                    display: flex;
                    justify-content: space-between;
                    margin-bottom: 0.25rem;
                  "
                >
                  <span style="font-weight: 600">Tired:</span>
                  <span id="probTiredValue">0%</span>
                </div>
                <div
                  style="
                    background: #e2e8f0;
                    height: 24px;
                    border-radius: 12px;
                    overflow: hidden;
                  "
                >
                  <div
                    id="probTiredBar"
                    style="
                      height: 100%;
                      width: 0%;
                      background: linear-gradient(90deg, #f56565, #e53e3e);
                      transition: width 0.5s;
                    "
                  ></div>
                </div>
              </div>
            </div>

            <!-- Facial Features -->
            <div
              id="facialFeatures"
              style="
                background: #f7fafc;
                padding: 1rem;
                border-radius: 8px;
                font-size: 0.9rem;
                display: none;
              "
            >
              <p style="font-weight: 600; margin-bottom: 0.5rem">
                Facial Features:
              </p>
              <div id="featuresContent"></div>
            </div>
          </div>

          <div class="notes">
            <p>
              <strong>System Status:</strong>
              <em id="connectionStatus">Checking connection...</em>
            </p>
            <p class="muted">
              The AI processing uses a 3-class CNN model with rule-based
              calibration (NUCLEAR MODE).
            </p>
          </div>
        </section>

        <aside class="demo-right">
          <div class="card">
            <h3>Live Logs</h3>
            <div
              id="logAreaFatV2"
              style="
                max-height: 300px;
                overflow-y: auto;
                font-family: monospace;
                font-size: 0.9em;
              "
            >
              Ready.
            </div>
          </div>

          <div class="card" style="margin-top: 1rem">
            <h3>Classification States</h3>
            <ul style="font-size: 0.9em; line-height: 1.8">
              <li>
                <strong style="color: #10b981">Alert:</strong> Normal, attentive
                state
              </li>
              <li>
                <strong style="color: #f59e0b">Non-Vigilant:</strong> Signs of
                fatigue detected
              </li>
              <li>
                <strong style="color: #ef4444">Tired:</strong> Active tiredness
                detected
              </li>
            </ul>
          </div>
        </aside>
      </main>

      <!-- Example Images Gallery -->
      <section class="fatigue-examples">
        <h2>Detection Examples (3 Classes)</h2>
        <p class="lead">
          See how the V2 system classifies different fatigue states:
        </p>

        <div class="example-gallery">
          <div class="example-card">
            <div class="example-image-wrapper">
              <img
                src="assets/fatigue photos/alert-state.jpeg"
                alt="Alert state - Normal detection"
                class="example-img"
              />
              <div class="example-status status-active">ALERT</div>
            </div>
            <div class="example-info">
              <h3>Alert State</h3>
              <p class="muted">
                Worker is fully attentive with eyes open and normal facial
                expressions. Green indicator shows safe working condition.
              </p>
              <div class="example-metrics">
                <span class="metric">Confidence: 98%</span>
                <span class="metric">Class: Alert</span>
              </div>
            </div>
          </div>

          <div class="example-card">
            <div class="example-image-wrapper">
              <img
                src="assets/fatigue photos/drowsy-state.jpeg"
                alt="Drowsy state - Fatigue warning"
                class="example-img"
              />
              <div class="example-status status-warning">DROWSY</div>
            </div>
            <div class="example-info">
              <h3>Non-Vigilant State</h3>
              <p class="muted">
                System detects signs of drowsiness with partially closed eyes
                and reduced alertness. Orange warning issued.
              </p>
              <div class="example-metrics">
                <span class="metric">Confidence: 92%</span>
                <span class="metric score-high">Class: Non-Vigilant</span>
              </div>
            </div>
          </div>

          <div class="example-card">
            <div class="example-image-wrapper">
              <img
                src="assets/fatigue photos/yawning-state.jpeg"
                alt="Yawning state - Critical fatigue"
                class="example-img"
              />
              <div class="example-status status-danger">YAWNING</div>
            </div>
            <div class="example-info">
              <h3>Tired State</h3>
              <p class="muted">
                Active tiredness detected indicating severe fatigue. Red alert
                triggers immediate intervention recommendation.
              </p>
              <div class="example-metrics">
                <span class="metric">Confidence: 95%</span>
                <span class="metric score-high">Class: Tired</span>
              </div>
            </div>
          </div>
        </div>
      </section>

      <footer class="mini-footer">SUT Project Demo</footer>
    </div>

    <script src="app.js"></script>
  </body>
</html>
